<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <!-- Server action for resetting and updating balances -->
    <!-- IMPORTANT: Action must be defined BEFORE the view that references it -->
    <record id="bio_action_server_reset_balances" model="ir.actions.server">
        <field name="name">Reset and Update Balances</field>
        <field name="model_id" ref="model_bio_account_move_line_balance"/>
        <field name="state">code</field>
        <field name="code">action = env['bio.account.move.line.balance'].reset_and_update_balances()</field>
    </record>

    <!-- Tree view with button to reset balances -->
    <record id="bio_account_move_line_balance_view_tree" model="ir.ui.view">
        <field name="name">bio.account.move.line.balance.tree</field>
        <field name="model">bio.account.move.line.balance</field>
        <field name="arch" type="xml">
            <tree>
                <header>
                    <button name="%(bio_action_server_reset_balances)d" string="Reset and Update"
                            type="action" class="btn-primary"/>
                </header>
                <field name="move_line_id"/>
                <field name="company_currency_id"/>
                <field name="bio_initial_balance"/>
                <field name="bio_end_balance"/>
            </tree>
        </field>
    </record>

    <!-- Action window -->
    <record id="bio_account_move_line_balance_action" model="ir.actions.act_window">
        <field name="name">Account Move Line Balance</field>
        <field name="res_model">bio.account.move.line.balance</field>
        <field name="view_mode">list</field>
    </record>

    <!-- Menu item in Accounting > Configuration -->
    <menuitem id="bio_account_move_line_balance_menu"
              parent="account.menu_finance_configuration"
              sequence="1001"
              name="Account Move Line Balance"
              action="bio_account_move_line_balance_action"/>

</odoo>
